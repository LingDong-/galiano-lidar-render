#include <math.h>
#include <stdio.h>
#define no_segfault_yet printf("no segfault yet on line %d!\n",__LINE__);

#include "conf.h"
#include "arg.h"

#define k 15
#define K (k*2+1)

float gs[W*H*3] = {0};
float gr[W*H*3] = {0};

int cnt0 = 0;
int cnt1 = 0;


float kern[K][K] = {{7.88647920e-07,1.40855549e-06,2.41709089e-06,3.98510917e-06,
6.31270776e-06,9.60769852e-06,1.40491895e-05,1.97383749e-05,
2.66440192e-05,3.45554302e-05,4.30587174e-05,5.15506442e-05,
5.92973553e-05,6.55337126e-05,6.95860910e-05,7.09918233e-05,
6.95860910e-05,6.55337126e-05,5.92973553e-05,5.15506442e-05,
4.30587174e-05,3.45554302e-05,2.66440192e-05,1.97383749e-05,
1.40491895e-05,9.60769852e-06,6.31270776e-06,3.98510917e-06,
2.41709089e-06,1.40855549e-06,7.88647920e-07},
{1.40855549e-06,2.51573424e-06,4.31701722e-06,7.11755812e-06,
1.12747387e-05,1.71597188e-05,2.50923923e-05,3.52534962e-05,
4.75872423e-05,6.17173263e-05,7.69045241e-05,9.20714316e-05,
1.05907355e-04,1.17045729e-04,1.24283433e-04,1.26794125e-04,
1.24283433e-04,1.17045729e-04,1.05907355e-04,9.20714316e-05,
7.69045241e-05,6.17173263e-05,4.75872423e-05,3.52534962e-05,
2.50923923e-05,1.71597188e-05,1.12747387e-05,7.11755812e-06,
4.31701722e-06,2.51573424e-06,1.40855549e-06},
{2.41709089e-06,4.31701722e-06,7.40803118e-06,1.22137786e-05,
1.93475289e-05,2.94461952e-05,4.30587174e-05,6.04952413e-05,
8.16600343e-05,1.05907355e-04,1.31968691e-04,1.57995208e-04,
1.81737749e-04,2.00851274e-04,2.13271224e-04,2.17579588e-04,
2.13271224e-04,2.00851274e-04,1.81737749e-04,1.57995208e-04,
1.31968691e-04,1.05907355e-04,8.16600343e-05,6.04952413e-05,
4.30587174e-05,2.94461952e-05,1.93475289e-05,1.22137786e-05,
7.40803118e-06,4.31701722e-06,2.41709089e-06},
{3.98510917e-06,7.11755812e-06,1.22137786e-05,2.01371165e-05,
3.18986824e-05,4.85485683e-05,7.09918233e-05,9.97397911e-05,
1.34634636e-04,1.74611710e-04,2.17579588e-04,2.60490061e-04,
2.99634892e-04,3.31147768e-04,3.51624803e-04,3.58728095e-04,
3.51624803e-04,3.31147768e-04,2.99634892e-04,2.60490061e-04,
2.17579588e-04,1.74611710e-04,1.34634636e-04,9.97397911e-05,
7.09918233e-05,4.85485683e-05,3.18986824e-05,2.01371165e-05,
1.22137786e-05,7.11755812e-06,3.98510917e-06},
{6.31270776e-06,1.12747387e-05,1.93475289e-05,3.18986824e-05,
5.05298730e-05,7.69045241e-05,1.12456300e-04,1.57995208e-04,
2.13271224e-04,2.76597867e-04,3.44662165e-04,4.12635529e-04,
4.74643837e-04,5.24562565e-04,5.56999703e-04,5.68251843e-04,
5.56999703e-04,5.24562565e-04,4.74643837e-04,4.12635529e-04,
3.44662165e-04,2.76597867e-04,2.13271224e-04,1.57995208e-04,
1.12456300e-04,7.69045241e-05,5.05298730e-05,3.18986824e-05,
1.93475289e-05,1.12747387e-05,6.31270776e-06},
{9.60769852e-06,1.71597188e-05,2.94461952e-05,4.85485683e-05,
7.69045241e-05,1.17045729e-04,1.71154166e-04,2.40462633e-04,
3.24590603e-04,4.20971319e-04,5.24562565e-04,6.28015411e-04,
7.22389673e-04,7.98364058e-04,8.47732134e-04,8.64857459e-04,
8.47732134e-04,7.98364058e-04,7.22389673e-04,6.28015411e-04,
5.24562565e-04,4.20971319e-04,3.24590603e-04,2.40462633e-04,
1.71154166e-04,1.17045729e-04,7.69045241e-05,4.85485683e-05,
2.94461952e-05,1.71597188e-05,9.60769852e-06},
{1.40491895e-05,2.50923923e-05,4.30587174e-05,7.09918233e-05,
1.12456300e-04,1.71154166e-04,2.50276099e-04,3.51624803e-04,
4.74643837e-04,6.15579873e-04,7.67059755e-04,9.18337258e-04,
1.05633929e-03,1.16743546e-03,1.23962564e-03,1.26466773e-03,
1.23962564e-03,1.16743546e-03,1.05633929e-03,9.18337258e-04,
7.67059755e-04,6.15579873e-04,4.74643837e-04,3.51624803e-04,
2.50276099e-04,1.71154166e-04,1.12456300e-04,7.09918233e-05,
4.30587174e-05,2.50923923e-05,1.40491895e-05},
{1.97383749e-05,3.52534962e-05,6.04952413e-05,9.97397911e-05,
1.57995208e-04,2.40462633e-04,3.51624803e-04,4.94014420e-04,
6.66849715e-04,8.64857459e-04,1.07767875e-03,1.29021572e-03,
1.48410133e-03,1.64018563e-03,1.74160905e-03,1.77679189e-03,
1.74160905e-03,1.64018563e-03,1.48410133e-03,1.29021572e-03,
1.07767875e-03,8.64857459e-04,6.66849715e-04,4.94014420e-04,
3.51624803e-04,2.40462633e-04,1.57995208e-04,9.97397911e-05,
6.04952413e-05,3.52534962e-05,1.97383749e-05},
{2.66440192e-05,4.75872423e-05,8.16600343e-05,1.34634636e-04,
2.13271224e-04,3.24590603e-04,4.74643837e-04,6.66849715e-04,
9.00152961e-04,1.16743546e-03,1.45471416e-03,1.74160905e-03,
2.00332726e-03,2.21401902e-03,2.35092632e-03,2.39841818e-03,
2.35092632e-03,2.21401902e-03,2.00332726e-03,1.74160905e-03,
1.45471416e-03,1.16743546e-03,9.00152961e-04,6.66849715e-04,
4.74643837e-04,3.24590603e-04,2.13271224e-04,1.34634636e-04,
8.16600343e-05,4.75872423e-05,2.66440192e-05},
{3.45554302e-05,6.17173263e-05,1.05907355e-04,1.74611710e-04,
2.76597867e-04,4.20971319e-04,6.15579873e-04,8.64857459e-04,
1.16743546e-03,1.51408217e-03,1.88666256e-03,2.25874518e-03,
2.59817539e-03,2.87142789e-03,3.04898707e-03,3.11058069e-03,
3.04898707e-03,2.87142789e-03,2.59817539e-03,2.25874518e-03,
1.88666256e-03,1.51408217e-03,1.16743546e-03,8.64857459e-04,
6.15579873e-04,4.20971319e-04,2.76597867e-04,1.74611710e-04,
1.05907355e-04,6.17173263e-05,3.45554302e-05},
{4.30587174e-05,7.69045241e-05,1.31968691e-04,2.17579588e-04,
3.44662165e-04,5.24562565e-04,7.67059755e-04,1.07767875e-03,
1.45471416e-03,1.88666256e-03,2.35092632e-03,2.81456980e-03,
3.23752590e-03,3.57801947e-03,3.79927184e-03,3.87602222e-03,
3.79927184e-03,3.57801947e-03,3.23752590e-03,2.81456980e-03,
2.35092632e-03,1.88666256e-03,1.45471416e-03,1.07767875e-03,
7.67059755e-04,5.24562565e-04,3.44662165e-04,2.17579588e-04,
1.31968691e-04,7.69045241e-05,4.30587174e-05},
{5.15506442e-05,9.20714316e-05,1.57995208e-04,2.60490061e-04,
4.12635529e-04,6.28015411e-04,9.18337258e-04,1.29021572e-03,
1.74160905e-03,2.25874518e-03,2.81456980e-03,3.36965184e-03,
3.87602222e-03,4.28366704e-03,4.54855421e-03,4.64044110e-03,
4.54855421e-03,4.28366704e-03,3.87602222e-03,3.36965184e-03,
2.81456980e-03,2.25874518e-03,1.74160905e-03,1.29021572e-03,
9.18337258e-04,6.28015411e-04,4.12635529e-04,2.60490061e-04,
1.57995208e-04,9.20714316e-05,5.15506442e-05},
{5.92973553e-05,1.05907355e-04,1.81737749e-04,2.99634892e-04,
4.74643837e-04,7.22389673e-04,1.05633929e-03,1.48410133e-03,
2.00332726e-03,2.59817539e-03,3.23752590e-03,3.87602222e-03,
4.45848681e-03,4.92738996e-03,5.23208273e-03,5.33777782e-03,
5.23208273e-03,4.92738996e-03,4.45848681e-03,3.87602222e-03,
3.23752590e-03,2.59817539e-03,2.00332726e-03,1.48410133e-03,
1.05633929e-03,7.22389673e-04,4.74643837e-04,2.99634892e-04,
1.81737749e-04,1.05907355e-04,5.92973553e-05},
{6.55337126e-05,1.17045729e-04,2.00851274e-04,3.31147768e-04,
5.24562565e-04,7.98364058e-04,1.16743546e-03,1.64018563e-03,
2.21401902e-03,2.87142789e-03,3.57801947e-03,4.28366704e-03,
4.92738996e-03,5.44560808e-03,5.78234568e-03,5.89915681e-03,
5.78234568e-03,5.44560808e-03,4.92738996e-03,4.28366704e-03,
3.57801947e-03,2.87142789e-03,2.21401902e-03,1.64018563e-03,
1.16743546e-03,7.98364058e-04,5.24562565e-04,3.31147768e-04,
2.00851274e-04,1.17045729e-04,6.55337126e-05},
{6.95860910e-05,1.24283433e-04,2.13271224e-04,3.51624803e-04,
5.56999703e-04,8.47732134e-04,1.23962564e-03,1.74160905e-03,
2.35092632e-03,3.04898707e-03,3.79927184e-03,4.54855421e-03,
5.23208273e-03,5.78234568e-03,6.13990597e-03,6.26394029e-03,
6.13990597e-03,5.78234568e-03,5.23208273e-03,4.54855421e-03,
3.79927184e-03,3.04898707e-03,2.35092632e-03,1.74160905e-03,
1.23962564e-03,8.47732134e-04,5.56999703e-04,3.51624803e-04,
2.13271224e-04,1.24283433e-04,6.95860910e-05},
{7.09918233e-05,1.26794125e-04,2.17579588e-04,3.58728095e-04,
5.68251843e-04,8.64857459e-04,1.26466773e-03,1.77679189e-03,
2.39841818e-03,3.11058069e-03,3.87602222e-03,4.64044110e-03,
5.33777782e-03,5.89915681e-03,6.26394029e-03,6.39048028e-03,
6.26394029e-03,5.89915681e-03,5.33777782e-03,4.64044110e-03,
3.87602222e-03,3.11058069e-03,2.39841818e-03,1.77679189e-03,
1.26466773e-03,8.64857459e-04,5.68251843e-04,3.58728095e-04,
2.17579588e-04,1.26794125e-04,7.09918233e-05},
{6.95860910e-05,1.24283433e-04,2.13271224e-04,3.51624803e-04,
5.56999703e-04,8.47732134e-04,1.23962564e-03,1.74160905e-03,
2.35092632e-03,3.04898707e-03,3.79927184e-03,4.54855421e-03,
5.23208273e-03,5.78234568e-03,6.13990597e-03,6.26394029e-03,
6.13990597e-03,5.78234568e-03,5.23208273e-03,4.54855421e-03,
3.79927184e-03,3.04898707e-03,2.35092632e-03,1.74160905e-03,
1.23962564e-03,8.47732134e-04,5.56999703e-04,3.51624803e-04,
2.13271224e-04,1.24283433e-04,6.95860910e-05},
{6.55337126e-05,1.17045729e-04,2.00851274e-04,3.31147768e-04,
5.24562565e-04,7.98364058e-04,1.16743546e-03,1.64018563e-03,
2.21401902e-03,2.87142789e-03,3.57801947e-03,4.28366704e-03,
4.92738996e-03,5.44560808e-03,5.78234568e-03,5.89915681e-03,
5.78234568e-03,5.44560808e-03,4.92738996e-03,4.28366704e-03,
3.57801947e-03,2.87142789e-03,2.21401902e-03,1.64018563e-03,
1.16743546e-03,7.98364058e-04,5.24562565e-04,3.31147768e-04,
2.00851274e-04,1.17045729e-04,6.55337126e-05},
{5.92973553e-05,1.05907355e-04,1.81737749e-04,2.99634892e-04,
4.74643837e-04,7.22389673e-04,1.05633929e-03,1.48410133e-03,
2.00332726e-03,2.59817539e-03,3.23752590e-03,3.87602222e-03,
4.45848681e-03,4.92738996e-03,5.23208273e-03,5.33777782e-03,
5.23208273e-03,4.92738996e-03,4.45848681e-03,3.87602222e-03,
3.23752590e-03,2.59817539e-03,2.00332726e-03,1.48410133e-03,
1.05633929e-03,7.22389673e-04,4.74643837e-04,2.99634892e-04,
1.81737749e-04,1.05907355e-04,5.92973553e-05},
{5.15506442e-05,9.20714316e-05,1.57995208e-04,2.60490061e-04,
4.12635529e-04,6.28015411e-04,9.18337258e-04,1.29021572e-03,
1.74160905e-03,2.25874518e-03,2.81456980e-03,3.36965184e-03,
3.87602222e-03,4.28366704e-03,4.54855421e-03,4.64044110e-03,
4.54855421e-03,4.28366704e-03,3.87602222e-03,3.36965184e-03,
2.81456980e-03,2.25874518e-03,1.74160905e-03,1.29021572e-03,
9.18337258e-04,6.28015411e-04,4.12635529e-04,2.60490061e-04,
1.57995208e-04,9.20714316e-05,5.15506442e-05},
{4.30587174e-05,7.69045241e-05,1.31968691e-04,2.17579588e-04,
3.44662165e-04,5.24562565e-04,7.67059755e-04,1.07767875e-03,
1.45471416e-03,1.88666256e-03,2.35092632e-03,2.81456980e-03,
3.23752590e-03,3.57801947e-03,3.79927184e-03,3.87602222e-03,
3.79927184e-03,3.57801947e-03,3.23752590e-03,2.81456980e-03,
2.35092632e-03,1.88666256e-03,1.45471416e-03,1.07767875e-03,
7.67059755e-04,5.24562565e-04,3.44662165e-04,2.17579588e-04,
1.31968691e-04,7.69045241e-05,4.30587174e-05},
{3.45554302e-05,6.17173263e-05,1.05907355e-04,1.74611710e-04,
2.76597867e-04,4.20971319e-04,6.15579873e-04,8.64857459e-04,
1.16743546e-03,1.51408217e-03,1.88666256e-03,2.25874518e-03,
2.59817539e-03,2.87142789e-03,3.04898707e-03,3.11058069e-03,
3.04898707e-03,2.87142789e-03,2.59817539e-03,2.25874518e-03,
1.88666256e-03,1.51408217e-03,1.16743546e-03,8.64857459e-04,
6.15579873e-04,4.20971319e-04,2.76597867e-04,1.74611710e-04,
1.05907355e-04,6.17173263e-05,3.45554302e-05},
{2.66440192e-05,4.75872423e-05,8.16600343e-05,1.34634636e-04,
2.13271224e-04,3.24590603e-04,4.74643837e-04,6.66849715e-04,
9.00152961e-04,1.16743546e-03,1.45471416e-03,1.74160905e-03,
2.00332726e-03,2.21401902e-03,2.35092632e-03,2.39841818e-03,
2.35092632e-03,2.21401902e-03,2.00332726e-03,1.74160905e-03,
1.45471416e-03,1.16743546e-03,9.00152961e-04,6.66849715e-04,
4.74643837e-04,3.24590603e-04,2.13271224e-04,1.34634636e-04,
8.16600343e-05,4.75872423e-05,2.66440192e-05},
{1.97383749e-05,3.52534962e-05,6.04952413e-05,9.97397911e-05,
1.57995208e-04,2.40462633e-04,3.51624803e-04,4.94014420e-04,
6.66849715e-04,8.64857459e-04,1.07767875e-03,1.29021572e-03,
1.48410133e-03,1.64018563e-03,1.74160905e-03,1.77679189e-03,
1.74160905e-03,1.64018563e-03,1.48410133e-03,1.29021572e-03,
1.07767875e-03,8.64857459e-04,6.66849715e-04,4.94014420e-04,
3.51624803e-04,2.40462633e-04,1.57995208e-04,9.97397911e-05,
6.04952413e-05,3.52534962e-05,1.97383749e-05},
{1.40491895e-05,2.50923923e-05,4.30587174e-05,7.09918233e-05,
1.12456300e-04,1.71154166e-04,2.50276099e-04,3.51624803e-04,
4.74643837e-04,6.15579873e-04,7.67059755e-04,9.18337258e-04,
1.05633929e-03,1.16743546e-03,1.23962564e-03,1.26466773e-03,
1.23962564e-03,1.16743546e-03,1.05633929e-03,9.18337258e-04,
7.67059755e-04,6.15579873e-04,4.74643837e-04,3.51624803e-04,
2.50276099e-04,1.71154166e-04,1.12456300e-04,7.09918233e-05,
4.30587174e-05,2.50923923e-05,1.40491895e-05},
{9.60769852e-06,1.71597188e-05,2.94461952e-05,4.85485683e-05,
7.69045241e-05,1.17045729e-04,1.71154166e-04,2.40462633e-04,
3.24590603e-04,4.20971319e-04,5.24562565e-04,6.28015411e-04,
7.22389673e-04,7.98364058e-04,8.47732134e-04,8.64857459e-04,
8.47732134e-04,7.98364058e-04,7.22389673e-04,6.28015411e-04,
5.24562565e-04,4.20971319e-04,3.24590603e-04,2.40462633e-04,
1.71154166e-04,1.17045729e-04,7.69045241e-05,4.85485683e-05,
2.94461952e-05,1.71597188e-05,9.60769852e-06},
{6.31270776e-06,1.12747387e-05,1.93475289e-05,3.18986824e-05,
5.05298730e-05,7.69045241e-05,1.12456300e-04,1.57995208e-04,
2.13271224e-04,2.76597867e-04,3.44662165e-04,4.12635529e-04,
4.74643837e-04,5.24562565e-04,5.56999703e-04,5.68251843e-04,
5.56999703e-04,5.24562565e-04,4.74643837e-04,4.12635529e-04,
3.44662165e-04,2.76597867e-04,2.13271224e-04,1.57995208e-04,
1.12456300e-04,7.69045241e-05,5.05298730e-05,3.18986824e-05,
1.93475289e-05,1.12747387e-05,6.31270776e-06},
{3.98510917e-06,7.11755812e-06,1.22137786e-05,2.01371165e-05,
3.18986824e-05,4.85485683e-05,7.09918233e-05,9.97397911e-05,
1.34634636e-04,1.74611710e-04,2.17579588e-04,2.60490061e-04,
2.99634892e-04,3.31147768e-04,3.51624803e-04,3.58728095e-04,
3.51624803e-04,3.31147768e-04,2.99634892e-04,2.60490061e-04,
2.17579588e-04,1.74611710e-04,1.34634636e-04,9.97397911e-05,
7.09918233e-05,4.85485683e-05,3.18986824e-05,2.01371165e-05,
1.22137786e-05,7.11755812e-06,3.98510917e-06},
{2.41709089e-06,4.31701722e-06,7.40803118e-06,1.22137786e-05,
1.93475289e-05,2.94461952e-05,4.30587174e-05,6.04952413e-05,
8.16600343e-05,1.05907355e-04,1.31968691e-04,1.57995208e-04,
1.81737749e-04,2.00851274e-04,2.13271224e-04,2.17579588e-04,
2.13271224e-04,2.00851274e-04,1.81737749e-04,1.57995208e-04,
1.31968691e-04,1.05907355e-04,8.16600343e-05,6.04952413e-05,
4.30587174e-05,2.94461952e-05,1.93475289e-05,1.22137786e-05,
7.40803118e-06,4.31701722e-06,2.41709089e-06},
{1.40855549e-06,2.51573424e-06,4.31701722e-06,7.11755812e-06,
1.12747387e-05,1.71597188e-05,2.50923923e-05,3.52534962e-05,
4.75872423e-05,6.17173263e-05,7.69045241e-05,9.20714316e-05,
1.05907355e-04,1.17045729e-04,1.24283433e-04,1.26794125e-04,
1.24283433e-04,1.17045729e-04,1.05907355e-04,9.20714316e-05,
7.69045241e-05,6.17173263e-05,4.75872423e-05,3.52534962e-05,
2.50923923e-05,1.71597188e-05,1.12747387e-05,7.11755812e-06,
4.31701722e-06,2.51573424e-06,1.40855549e-06},
{7.88647920e-07,1.40855549e-06,2.41709089e-06,3.98510917e-06,
6.31270776e-06,9.60769852e-06,1.40491895e-05,1.97383749e-05,
2.66440192e-05,3.45554302e-05,4.30587174e-05,5.15506442e-05,
5.92973553e-05,6.55337126e-05,6.95860910e-05,7.09918233e-05,
6.95860910e-05,6.55337126e-05,5.92973553e-05,5.15506442e-05,
4.30587174e-05,3.45554302e-05,2.66440192e-05,1.97383749e-05,
1.40491895e-05,9.60769852e-06,6.31270776e-06,3.98510917e-06,
2.41709089e-06,1.40855549e-06,7.88647920e-07}};



int main(){

  FILE* fp = fopen("data/" CLS "0_" ID ".npy","rb");
  fseek(fp,128,SEEK_SET);
  for (int i = 0; i < H; i++){
    for (int j = 0; j < W; j++){
      float x,y,z;
      fread(&x,4,1,fp);
      fread(&y,4,1,fp);
      fread(&z,4,1,fp);
      gs[(i*W+j)*3]=x;
      gs[(i*W+j)*3+1]=y;
      gs[(i*W+j)*3+2]=z;

      gr[(i*W+j)*3]=x;
      gr[(i*W+j)*3+1]=y;
      gr[(i*W+j)*3+2]=z;
    }
  }


  for (int i = 0; i < H; i++){
    if (i%1000 == 0) printf("%d/%d\n",i,H);
    for (int j = 0; j < W; j++){
      if (gr[(i*W+j)*3] == -INFINITY){
        cnt0+=1;

        float c = 0;
        float s = 0;
        for (int ii = i-k; ii<=i+k; ii++){
          for (int jj = j-k; jj<=j+k; jj++){
            if ( ii < 0 || ii >= H){
              continue;
            }
            if ( jj < 0 || jj >= W){
              continue;
            }
            if (gr[(ii*W+jj)*3+2] != -INFINITY){
              int kx = (ii-(i-k));
              int ky = (jj-(j-k));
              float f = kern[kx][ky];
              s += gr[(ii*W+jj)*3+2]*f;
              c += f;
            }
          }
        }
        if (c){
          gs[(i*W+j)*3+2] = s/c;
          int ii = 0;
          int jj = 0;
          while (1){
            
            if (j+jj < W && gr[(i*W+j+jj)*3]!=-INFINITY){
              gs[(i*W+j)*3] = gr[(i*W+j+jj)*3];
              break;
            }
            if (j-jj >= 0 && gr[(i*W+j-jj)*3]!=-INFINITY){
              gs[(i*W+j)*3] = gr[(i*W+j-jj)*3];
              break;
            }
            jj+=1;
            if (jj > 100000){
              // printf("fail.\n");
              break;
            }
          }
          while (1){
            if (i+ii < H && gr[((i+ii)*W+j)*3+1]!=-INFINITY){
              gs[(i*W+j)*3+1] = gr[((i+ii)*W+j)*3+1];
              break;
            }
            if (i-ii >= 0 && gr[((i-ii)*W+j)*3+1]!=-INFINITY){
              gs[(i*W+j)*3+1] = gr[((i-ii)*W+j)*3+1];
              break;
            }
            ii+=1;
            if (ii > 100000){
              // printf("fail.\n");
              break;
            }
          }
          cnt1 += 1;
        }
      }
    }
  }
  printf("%f\n",(float)(cnt0)/(H*W));
  printf("%f\n",(float)(cnt1)/(cnt0));


  FILE* fd = fopen("output/" CLS "_" ID ".npy","wb");
  fseek(fp,0,SEEK_SET);
  for (int i = 0; i < 128; i++){
    fputc(fgetc(fp),fd);
  }
  for (int i = 0; i < H; i++){
    for (int j = 0; j < W; j++){
      float x,y,z;
      x = gs[(i*W+j)*3];
      y = gs[(i*W+j)*3+1];
      z = gs[(i*W+j)*3+2];
      fwrite(&x,4,1,fd);
      fwrite(&y,4,1,fd);
      fwrite(&z,4,1,fd);
    }
  }
  fclose(fd);
}